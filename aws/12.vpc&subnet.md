- <img width="1350" alt="스크린샷 2023-04-18 오후 10 51 34" src="https://user-images.githubusercontent.com/62214428/232798748-7d18e926-9482-4cf7-a49e-31ea7be09c8d.png">
```
대부분의 aws 서비스(s3등)은 퍼블릭 인터넷을 통해 접근할 수 있다.

다만! vpc는 !원칙적으로는! 외부에서 접근할 수 없다.
- 또한 vpc내부는 같은 클라우드 환경(ex.s3)라도 바로 접근할 수 없다 원칙적으로는
- 즉 vpc란 외부와 격리된 인터넷 환경을 구축하는 목적

aws 서비스 중 ec2는 vpc 내부에 존재.
우리가 외부에서 ec2로 접근할 수 있는 이유는 internet gateway를 통해 외부로 접근하는 길을 뚫은것
```

### vpc란
- virtual private cloud
- 사용자의 aws 계정 전용 가상 네트워크
- 즉 외부와 격리된 가상의 네트워크 환경
- `vpc는 aws 클라우드에서 다른 가상 네트워크와 논리적으로 분리되어있다.`
- <img width="1114" alt="스크린샷 2023-04-18 오후 10 58 30" src="https://user-images.githubusercontent.com/62214428/232800662-2d66567d-4f62-4aa9-9a78-cb498cb2e3dc.png">
```
- 부여된 ip 대역을 분할하여(서브넷) 사용 가능
사진에서 볼 수 있듯이 cidr로 표기된 10.0.0.0/16 네트워크 대역을 vpc가 부여받았다.
그리고 각 서브넷 (10.0.0.0/24), (10.0.1.0/24)가 이를 분할하여 사용하고 있는것

- 리전 단위
```

### vpc 구성요소
1. 서브넷
- vpc의 하위 단위로 vpc에 할당된 ip를 더 작은 단위로 분할한개념
- `하나의 서브넷은 하나의 가용역역안에 위치`
- cidr block range로 ip 주소 표기
- 참고로 aws의 사용 가능 ip 숫자는 5개를 제외하고 계산
  - 예를들어 서브넷 ip 대역이 10.0.0.0/24라면
  - 10.0.0.0 : 네트워크 어드레스 용도
  - 10.0.0.1 : vpc router
  - 10.0.0.2 : dns server
  - 10.0.0.3 : 미래에 사용을 위해 남겨둠
  - 10.0.0.255 : 네트워크 브로드캐스트 어드레스
  - 따라서 사용가능한 ip 개수는 2^8 - 5 = 251개
- `서브넷의 종류`
  - `퍼블릭 서브넷` : 외부에서 인터넷을 통해 연결할 수 있는 서브넷
    - internet gateway를 통해 외부 인터넷과 연결
    - 안에 위치한 instance에 퍼블릭 ip부여 가능 
    - 그래서 ec2에 접근할 수 있었다.
  - `프라이빗 서브넷` : 외부에서 인터넷을 통해 연결할 수 없는 서브넷
    - 외부 인터넷으로의 경로도 없고 퍼블릭 ip부여 불가능
    - db 등 외부에 노출될 필요가 없는 인프라

2. 인터넷 게이트웨이
- vpc가 외부의 인터넷과 통신할 수 있도록 경로를 만들어주는 리소스
- 기본적으로 확장성 및 고가용성 확보
- ipv4, ipv6 ( ipv4의 경우 nat 역할 즉 `internet gateway가 nat의 역할을 수행`)
- route table에서 경로 설정 후 접근 가능
- <img width="1109" alt="스크린샷 2023-04-18 오후 11 20 28" src="https://user-images.githubusercontent.com/62214428/232806873-23399cdd-3945-431f-9362-3cf99470ca40.png">
```
그림의 1번의 경우 외부로 나가는 internet gateway가 연결된 서브넷 = 퍼블릭 서브넷
2번의 경우 외부로 나가는 경로 x = 프라이빗 서브넷
```

3. nacl/보안그룹

4. 라우트 테이블
- 트래픽이 어디로 가야할지 알려주는 이정표
- vpc 생성시 기본으로 하나 제공
- <img width="1165" alt="스크린샷 2023-04-18 오후 11 13 43" src="https://user-images.githubusercontent.com/62214428/232805202-4bb75078-8b55-4cb6-b0d1-6b74bd581fef.png">

```
ex)
1. subnet A의 인스턴스에서 10.0.1.31로 요청을 보내고 싶다!
2. 라우터 테이블을 살펴보니 10.0.1.31에 매칭되는 target은 로컬이 있구나!
3. 로컬로 보내!

```

5. nat instance / nat gateway

6. bastion host

7. vpc endpoint
